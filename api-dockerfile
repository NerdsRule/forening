FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
WORKDIR /src

COPY src/Organization.ApiService/Organization.ApiService.csproj src/Organization.ApiService/
COPY src/Organization.Infrastructure/Organization.Infrastructure.csproj src/Organization.Infrastructure/
COPY src/Organization.Shared/Organization.Shared.csproj src/Organization.Shared/
COPY src/Organization.ServiceDefaults/Organization.ServiceDefaults.csproj src/Organization.ServiceDefaults/

RUN dotnet restore src/Organization.ApiService/Organization.ApiService.csproj

COPY src/ src/
WORKDIR /src/src/Organization.ApiService
RUN dotnet publish Organization.ApiService.csproj -c Release -o /app/publish /p:UseAppHost=false

FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS final
WORKDIR /app

ENV ASPNETCORE_URLS=http://+:80
ENV PORT=80
ENV WEBSITES_PORT=80
EXPOSE 80

COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "Organization.ApiService.dll"]
